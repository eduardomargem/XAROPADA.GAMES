<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xaropada Games - Pagamento</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* Estilo Pixel/Retrô Xaropada Games */
        :root {
            --primary: #00ff85;
            --secondary: #00cc66;
            --accent: #ff00aa;
            --dark: #1a1a2e;
            --dark-secondary: #2a2a4a;
            --light: #f8f9fa;
            --success: #00ff85;
            --error: #ff3333;
            --info: #00aaff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Press Start 2P', cursive;
            image-rendering: pixelated;
        }
        
        body {
            background-color: var(--dark);
            color: var(--primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        header {
            width: 100%;
            background-color: var(--dark-secondary);
            padding: 20px 0;
            border-bottom: 4px solid var(--secondary);
            box-shadow: 0 4px 0 #000;
            margin-bottom: 30px;
        }
        
        .container {
            width: 90%;
            max-width: 800px;
            margin-bottom: 40px;
        }
        
        /* Estilo do logo com imagem */
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .logo-img {
            height: 50px;
            image-rendering: pixelated;
        }
        
        .logo-text {
            font-size: 1.8rem;
            text-shadow: 3px 3px 0 #000;
            animation: pulse 2s infinite;
        }
        
        .logo-text span {
            color: var(--accent);
        }
        
        /* Card de Pagamento Estilo Pixel */
        .payment-card {
            background-color: var(--dark-secondary);
            border: 4px solid var(--secondary);
            border-radius: 0;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 8px 8px 0 #000;
            position: relative;
        }
        
        .payment-card::before {
            content: "";
            position: absolute;
            top: 5px;
            left: 5px;
            right: -5px;
            bottom: -5px;
            border: 2px solid var(--accent);
            z-index: -1;
        }
        
        .payment-card h2 {
            color: var(--primary);
            margin-bottom: 25px;
            font-size: 1.3rem;
            text-shadow: 2px 2px 0 #000;
            border-bottom: 3px solid var(--accent);
            padding-bottom: 10px;
        }
        
        /* Opções de Pagamento */
        .payment-option {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 3px solid #3a3a5a;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #2a2a4a;
            position: relative;
        }
        
        .payment-option:hover {
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0 #000;
            border-color: var(--secondary);
        }
        
        .payment-option.selected {
            border: 3px solid var(--primary);
            background-color: rgba(0, 255, 133, 0.1);
            box-shadow: 4px 4px 0 #000;
        }
        
        .payment-option input[type="radio"] {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            appearance: none;
            border: 3px solid #3a3a5a;
            background-color: #1a1a2e;
            position: relative;
        }
        
        .payment-option input[type="radio"]:checked {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        
        .payment-option input[type="radio"]:checked::after {
            content: "✓";
            position: absolute;
            color: #000;
            font-size: 12px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .payment-info {
            flex-grow: 1;
        }
        
        .payment-info h3 {
            color: var(--primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .payment-info p {
            color: #aaa;
            font-size: 0.7rem;
            margin-left: 35px;
            line-height: 1.5;
        }
        
        .payment-icon {
            width: 28px;
            height: 28px;
            margin-right: 10px;
            background-color: var(--primary);
            border-radius: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 2px 2px 0 #000;
        }
        
        /* Botões */
        .btn {
            background-color: var(--primary);
            color: #000;
            border: none;
            padding: 15px 25px;
            border-radius: 0;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            box-shadow: 4px 4px 0 #000;
            text-transform: uppercase;
        }
        
        .btn:hover {
            background-color: var(--secondary);
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 #000;
        }
        
        .btn-accent {
            background-color: var(--accent);
            color: white;
        }
        
        .btn-accent:hover {
            background-color: #ff00cc;
        }
        
        /* Botões de Navegação */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn-back {
            background-color: var(--dark-secondary);
            color: var(--primary);
            border: 3px solid var(--primary);
            padding: 15px 25px;
            border-radius: 0;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            box-shadow: 4px 4px 0 #000;
            text-transform: uppercase;
            flex: 1;
            min-width: 150px;
        }
        
        .btn-back:hover {
            background-color: var(--primary);
            color: #000;
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 #000;
        }
        
        .btn-next {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 0;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            box-shadow: 4px 4px 0 #000;
            text-transform: uppercase;
            flex: 1;
            min-width: 150px;
        }
        
        .btn-next:hover {
            background-color: #ff00cc;
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 #000;
        }
        
        /* Modal de Cartão */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: var(--dark-secondary);
            border: 4px solid var(--primary);
            width: 90%;
            max-width: 500px;
            padding: 25px;
            box-shadow: 8px 8px 0 #000;
            position: relative;
            animation: modalFadeIn 0.3s;
        }
        
        .modal-content::before {
            content: "";
            position: absolute;
            top: 5px;
            left: 5px;
            right: -5px;
            bottom: -5px;
            border: 2px solid var(--accent);
            z-index: -1;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--accent);
        }
        
        .modal-header h3 {
            color: var(--primary);
            font-size: 1.2rem;
            text-shadow: 2px 2px 0 #000;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--primary);
            transition: transform 0.2s;
        }
        
        .close-modal:hover {
            transform: rotate(90deg);
        }
        
        /* Formulário */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--primary);
            font-size: 0.8rem;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 3px solid #3a3a5a;
            background-color: #1a1a2e;
            color: var(--primary);
            font-size: 0.9rem;
        }
        
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px var(--accent);
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 3px solid var(--accent);
        }
        
        /* Notificações */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            border: 3px solid #000;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1001;
            animation: slideIn 0.3s;
            box-shadow: 4px 4px 0 #000;
            font-size: 0.8rem;
        }
        
        .notification.sucesso {
            background-color: var(--success);
            color: #000;
        }
        
        .notification.erro {
            background-color: var(--error);
        }
        
        .notification.info {
            background-color: var(--info);
        }
        
        .notification.fade-out {
            animation: fadeOut 0.5s;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .logo-text {
                font-size: 1.4rem;
            }
            
            .logo-img {
                height: 40px;
            }
            
            .payment-card h2 {
                font-size: 1.1rem;
            }
            
            .payment-info h3 {
                font-size: 0.8rem;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .btn, .btn-back, .btn-next {
                padding: 12px 20px;
                font-size: 0.8rem;
                min-width: 100%;
            }
            
            .navigation-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo-container">
                <img src="assets/img/spaceinvader2.png" alt="Invader Pixel" class="logo-img">
                <div class="logo-text">XAROPADA<span>GAMES</span></div>
            </div>
        </div>
    </header>
    
    <main class="container">
        <div class="payment-card">
            <h2>ESCOLHA COMO PAGAR</h2>
            
            <label class="payment-option selected">
                <input type="radio" name="payment" id="boleto" checked>
                <div class="payment-info">
                    <h3><span class="payment-icon">B</span> BOLETO BANCÁRIO</h3>
                    <p>APROVAÇÃO EM 1 A 2 DIAS ÚTEIS</p>
                </div>
            </label>
            
            <label class="payment-option">
                <input type="radio" name="payment" id="newCard">
                <div class="payment-info">
                    <h3><span class="payment-icon">C</span> CARTÃO DE CRÉDITO</h3>
                    <p>PAGAMENTO PARCELADO EM ATÉ 12X</p>
                </div>
            </label>
            
            <!-- Seção para exibir cartões salvos -->
            <div id="listaPagamentos" style="margin-top: 20px;"></div>
            
            <div class="navigation-buttons">
                <button class="btn-back" onclick="window.location.href='DadosEntrega.html'">
                    <i class="fas fa-arrow-left"></i> VOLTAR
                </button>
               <button id="confirmPayment" class="btn">CONFIRMAR PAGAMENTO</button>
                <button id="nextButton" class="btn-next">
                    AVANÇAR <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </main>
    
    <!-- Modal para adicionar cartão -->
    <div class="modal" id="cardModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ADICIONAR CARTÃO</h3>
                <button class="close-modal">&times;</button>
            </div>
            
            <form id="cardForm">
                <div class="form-group">
                    <label for="modalNumeroCartao">NÚMERO DO CARTÃO</label>
                    <input type="text" id="modalNumeroCartao" placeholder="0000 0000 0000 0000" required>
                </div>
                
                <div class="form-group">
                    <label for="modalNomeCartao">NOME NO CARTÃO</label>
                    <input type="text" id="modalNomeCartao" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="modalValidadeCartao">VALIDADE</label>
                        <input type="text" id="modalValidadeCartao" placeholder="MM/AAAA" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="modalCvvCartao">CVV</label>
                        <input type="text" id="modalCvvCartao" placeholder="000" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="modalParcelas">PARCELAMENTO</label>
                    <select id="modalParcelas" required>
                        <option value="">SELECIONE...</option>
                        <option value="1">1x SEM JUROS</option>
                        <option value="2">2x SEM JUROS</option>
                        <option value="3">3x SEM JUROS</option>
                        <option value="4">4x SEM JUROS</option>
                        <option value="5">5x SEM JUROS</option>
                        <option value="6">6x SEM JUROS</option>
                        <option value="10">10x COM JUROS</option>
                        <option value="12">12x COM JUROS</option>
                    </select>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn close-modal">CANCELAR</button>
                    <button type="submit" class="btn btn-accent">SALVAR CARTÃO</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Função para mostrar notificação
        function mostrarNotificacao(mensagem, tipo = 'sucesso') {
            const notification = document.createElement('div');
            notification.className = `notification ${tipo}`;
            notification.innerHTML = `
                <i class="fas fa-${tipo === 'erro' ? 'exclamation-circle' : tipo === 'info' ? 'info-circle' : 'check-circle'}"></i>
                ${mensagem}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        // Configura máscaras para os campos do cartão
        function configurarMascarasCartao() {
            document.getElementById('modalNumeroCartao').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                value = value.replace(/(\d{4})(?=\d)/g, '$1 ');
                e.target.value = value.trim().substring(0, 19);
            });
            
            document.getElementById('modalValidadeCartao').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 6);
                }
                e.target.value = value.substring(0, 7);
            });
            
            document.getElementById('modalCvvCartao').addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/\D/g, '').substring(0, 4);
            });
        }

        // Funções de validação de cartão
        function validarNumeroCartao(numero) {
            const numeroLimpo = numero.replace(/\s/g, '');
            return /^\d{16}$/.test(numeroLimpo);
        }

        function validarValidade(validade) {
            if (!/^\d{2}\/\d{4}$/.test(validade)) return false;
            
            const [mes, ano] = validade.split('/').map(Number);
            const agora = new Date();
            const anoAtual = agora.getFullYear();
            const mesAtual = agora.getMonth() + 1;
            
            if (ano < anoAtual) return false;
            if (ano === anoAtual && mes < mesAtual) return false;
            if (mes < 1 || mes > 12) return false;
            
            return true;
        }

        function validarCVV(cvv) {
            return /^\d{3,4}$/.test(cvv);
        }

        // Função para salvar o cartão
        function salvarCartao() {
            const nomeCartao = document.getElementById('modalNomeCartao').value;
            const numeroCartao = document.getElementById('modalNumeroCartao').value;
            const validadeCartao = document.getElementById('modalValidadeCartao').value;
            const cvvCartao = document.getElementById('modalCvvCartao').value;
            const parcelas = document.getElementById('modalParcelas').value;
            
            if (!nomeCartao || !numeroCartao || !validadeCartao || !cvvCartao || !parcelas) {
                mostrarNotificacao('PREENCHA TODOS OS CAMPOS!', 'erro');
                return;
            }
            
            if (!validarNumeroCartao(numeroCartao)) {
                mostrarNotificacao('NÚMERO DO CARTÃO INVÁLIDO!', 'erro');
                return;
            }
            
            if (!validarValidade(validadeCartao)) {
                mostrarNotificacao('VALIDADE INVÁLIDA! FORMATO: MM/AAAA', 'erro');
                return;
            }
            
            if (!validarCVV(cvvCartao)) {
                mostrarNotificacao('CVV INVÁLIDO! 3 OU 4 DÍGITOS', 'erro');
                return;
            }
            
            const clientes = JSON.parse(localStorage.getItem('usuariosCadastrados')) || [];
            const usuario = JSON.parse(localStorage.getItem('usuarioLogado'));
            
            if (!usuario) {
                mostrarNotificacao('USUÁRIO NÃO LOGADO!', 'erro');
                return;
            }
            
            const clienteIndex = clientes.findIndex(c => c.email === usuario.email);
            
            if (clienteIndex === -1) {
                mostrarNotificacao('USUÁRIO NÃO ENCONTRADO!', 'erro');
                return;
            }
            
            const novoPagamento = {
                tipo: 'credito',
                nomeCartao,
                numeroCartao: numeroCartao.replace(/\s/g, ''),
                ultimosDigitos: numeroCartao.slice(-4),
                validadeCartao,
                cvvCartao,
                parcelas,
                padrao: false
            };
            
            if (!clientes[clienteIndex].dadosCompletos) {
                clientes[clienteIndex].dadosCompletos = {};
            }
            
            if (!clientes[clienteIndex].dadosCompletos.formasPagamento) {
                clientes[clienteIndex].dadosCompletos.formasPagamento = [];
                novoPagamento.padrao = true;
            } else if (clientes[clienteIndex].dadosCompletos.formasPagamento.length === 0) {
                novoPagamento.padrao = true;
            }
            
            clientes[clienteIndex].dadosCompletos.formasPagamento.push(novoPagamento);
            localStorage.setItem('usuariosCadastrados', JSON.stringify(clientes));
            
            exibirCartoesSalvos();
            document.getElementById('cardForm').reset();
            document.getElementById('cardModal').style.display = 'none';
            mostrarNotificacao('CARTÃO SALVO COM SUCESSO!');
        }

        // Função para exibir cartões salvos
        function exibirCartoesSalvos() {
            const listaPagamentos = document.getElementById('listaPagamentos');
            listaPagamentos.innerHTML = '';
            
            const clientes = JSON.parse(localStorage.getItem('usuariosCadastrados')) || [];
            const usuario = JSON.parse(localStorage.getItem('usuarioLogado'));
            
            if (!usuario) return;
            
            const cliente = clientes.find(c => c.email === usuario.email);
            if (!cliente || !cliente.dadosCompletos || !cliente.dadosCompletos.formasPagamento) return;
            
            const pagamentos = cliente.dadosCompletos.formasPagamento;
            
            if (pagamentos.length === 0) return;
            
            const titulo = document.createElement('h3');
            titulo.textContent = 'CARTÕES SALVOS';
            titulo.style.margin = '20px 0 10px';
            titulo.style.color = 'var(--primary)';
            titulo.style.fontSize = '0.9rem';
            titulo.style.textShadow = '2px 2px 0 #000';
            listaPagamentos.appendChild(titulo);
            
            pagamentos.forEach((pagamento, index) => {
                if (pagamento.tipo === 'credito') {
                    const cartaoElement = document.createElement('div');
                    cartaoElement.className = 'payment-option';
                    cartaoElement.innerHTML = `
                        <input type="radio" name="savedCard" id="card-${index}">
                        <div class="payment-info">
                            <h3><span class="payment-icon">C</span> ${pagamento.nomeCartao}</h3>
                            <p>**** **** **** ${pagamento.ultimosDigitos} | VAL: ${pagamento.validadeCartao}</p>
                        </div>
                    `;
                    listaPagamentos.appendChild(cartaoElement);
                }
            });
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Verifica se o usuário está logado
            if (!localStorage.getItem('usuarioLogado')) {
                window.location.href = "index.html";
                return;
            }
            
            // Configura máscaras
            configurarMascarasCartao();
            
            // Exibe cartões salvos
            exibirCartoesSalvos();
            
            // Formulário de cartão
            document.getElementById('cardForm').addEventListener('submit', function(e) {
                e.preventDefault();
                salvarCartao();
            });
            
            // Botão para adicionar novo cartão
            document.getElementById('newCard').addEventListener('change', function() {
                if(this.checked) {
                    document.getElementById('cardModal').style.display = 'flex';
                }
            });
            
            // Fechar modal
            document.querySelectorAll('.close-modal').forEach(button => {
                button.addEventListener('click', function() {
                    document.getElementById('cardModal').style.display = 'none';
                    document.getElementById('boleto').checked = true;
                });
            });
            
            // Fechar modal ao clicar fora
            window.addEventListener('click', function(event) {
                if (event.target === document.getElementById('cardModal')) {
                    document.getElementById('cardModal').style.display = 'none';
                    document.getElementById('boleto').checked = true;
                }
            });
            
            // Confirmar pagamento
            document.getElementById('confirmPayment').addEventListener('click', function() {
                const selectedPayment = document.querySelector('input[name="payment"]:checked').id;
                const selectedCard = document.querySelector('input[name="savedCard"]:checked');
                
                if (selectedPayment === 'boleto') {
                    mostrarNotificacao('BOLETO GERADO! IMPRIMA OU COPIE O CÓDIGO.', 'sucesso');
                } else if (selectedPayment === 'newCard') {
                    if (selectedCard) {
                        mostrarNotificacao('PAGAMENTO COM CARTÃO CONFIRMADO!', 'sucesso');
                    } else {
                        mostrarNotificacao('SELECIONE OU ADICIONE UM CARTÃO!', 'info');
                        document.getElementById('cardModal').style.display = 'flex';
                    }
                } else {
                    mostrarNotificacao('SELECIONE UMA FORMA DE PAGAMENTO!', 'erro');
                }
            });
            
            // Botão Avançar
            document.getElementById('nextButton').addEventListener('click', function(e) {
                const selectedPayment = document.querySelector('input[name="payment"]:checked').id;
                
                if (selectedPayment === 'newCard') {
                    const selectedCard = document.querySelector('input[name="savedCard"]:checked');
                    if (!selectedCard) {
                        e.preventDefault();
                        mostrarNotificacao('SELECIONE OU ADICIONE UM CARTÃO ANTES DE AVANÇAR!', 'erro');
                        document.getElementById('cardModal').style.display = 'flex';
                        return;
                    }
                }
                
                // Se passou na validação, redireciona para Resumo.html
                window.location.href = 'Resumo.htm';
            });
        });
    </script>
</body>
</html>